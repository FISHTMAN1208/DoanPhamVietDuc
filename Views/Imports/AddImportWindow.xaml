<Window x:Class="DoanPhamVietDuc.Views.Imports.AddImportWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:DoanPhamVietDuc.Views.Imports"
        mc:Ignorable="d"
        Title="Tạo phiếu nhập" 
        Height="850" 
        Width="1400"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        Background="#F8FAFC">

    <Window.Resources>
        <Style x:Key="MaterialDesignOutlinedTextBoxWithBorder" 
               BasedOn="{StaticResource MaterialDesignOutlinedTextBox}" 
               TargetType="TextBox">
            <Setter Property="materialDesign:TextFieldAssist.UnderlineBrush" Value="#1E293B"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#6366F1"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="MaterialDesignOutlinedComboBoxWithBorder" 
               BasedOn="{StaticResource MaterialDesignOutlinedComboBox}" 
               TargetType="ComboBox">
            <Setter Property="materialDesign:TextFieldAssist.UnderlineBrush" Value="#1E293B"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#6366F1"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="MaterialDesignOutlinedDatePickerWithBorder" 
               BasedOn="{StaticResource MaterialDesignOutlinedDatePicker}" 
               TargetType="DatePicker">
            <Setter Property="materialDesign:TextFieldAssist.UnderlineBrush" Value="#1E293B"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#6366F1"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1E293B" Padding="20,15">
            <DockPanel LastChildFill="True">
                <materialDesign:PackIcon Kind="FileDocumentPlus" 
                                         Width="32" 
                                         Height="32" 
                                         Foreground="White" 
                                         VerticalAlignment="Center"/>
                <TextBlock Text="TẠO PHIẾU NHẬP" 
                           FontSize="22" 
                           FontWeight="Bold" 
                           Foreground="White" 
                           Margin="15,0,0,0" 
                           VerticalAlignment="Center"/>
            </DockPanel>
        </Border>

        <!-- Thông tin phiếu nhập -->
        <Grid Grid.Row="1" Margin="20,20,20,10">
            <GroupBox Header="Thông tin phiếu nhập" 
                      FontSize="16" 
                      FontWeight="Bold" 
                      Style="{StaticResource MaterialDesignGroupBox}">
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Nhà cung cấp -->
                    <ComboBox Grid.Row="0" 
                              Grid.Column="0"
                              Style="{StaticResource MaterialDesignOutlinedComboBoxWithBorder}"
                              materialDesign:HintAssist.Hint="Nhà cung cấp"
                              ItemsSource="{Binding Suppliers}"
                              SelectedValuePath="SupplierID"
                              SelectedValue="{Binding Import.SupplierID}"
                              DisplayMemberPath="SupplierName"
                              Margin="0,0,10,15"/>

                    <!-- Ngày nhập -->
                    <DatePicker Grid.Row="0" 
                                Grid.Column="1"
                                Style="{StaticResource MaterialDesignOutlinedDatePickerWithBorder}"
                                materialDesign:HintAssist.Hint="Ngày nhập"
                                SelectedDate="{Binding Import.ImportDate}"
                                Margin="0,0,10,15"/>

                    <!-- Trạng thái -->
                    <ComboBox Grid.Row="0" 
                              Grid.Column="2"
                              Style="{StaticResource MaterialDesignOutlinedComboBoxWithBorder}"
                              materialDesign:HintAssist.Hint="Trạng thái"
                              ItemsSource="{Binding StatusOptions}"
                              SelectedValue="{Binding Import.ImportStatus}"
                              Margin="0,0,0,15"/>

                    <!-- Người tạo -->
                    <TextBox Grid.Row="1" 
                             Grid.Column="0"
                             Style="{StaticResource MaterialDesignOutlinedTextBoxWithBorder}"
                             materialDesign:HintAssist.Hint="Người tạo"
                             Text="{Binding Import.CreateBy, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,10,15"/>

                    <!-- Ghi chú -->
                    <TextBox Grid.Row="1" 
                             Grid.Column="1"
                             Grid.ColumnSpan="2"
                             Style="{StaticResource MaterialDesignOutlinedTextBoxWithBorder}"
                             materialDesign:HintAssist.Hint="Ghi chú"
                             Text="{Binding Import.Notes, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,0,15"/>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- Chi tiết phiếu nhập -->
        <Grid Grid.Row="2" Margin="20,10,20,20">
            <GroupBox Header="Chi tiết phiếu nhập" 
                      FontSize="16" 
                      FontWeight="Bold" 
                      Style="{StaticResource MaterialDesignGroupBox}">
                <Grid Margin="0,10,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Form thêm chi tiết -->
                    <Grid Grid.Row="0" Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Sách -->
                        <ComboBox Grid.Column="0"
                                  Style="{StaticResource MaterialDesignOutlinedComboBoxWithBorder}"
                                  materialDesign:HintAssist.Hint="Chọn sách"
                                  ItemsSource="{Binding Books}"
                                  SelectedValuePath="ID"
                                  SelectedValue="{Binding CurrentDetail.BookID}"
                                  DisplayMemberPath="Title"
                                  Margin="0,0,10,0"/>

                        <!-- Số lượng -->
                        <TextBox Grid.Column="1"
                                 Style="{StaticResource MaterialDesignOutlinedTextBoxWithBorder}"
                                 materialDesign:HintAssist.Hint="Số lượng"
                                 Text="{Binding CurrentDetail.Quantity, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,10,0"/>

                        <!-- Đơn giá nhập -->
                        <TextBox Grid.Column="2"
                                 Style="{StaticResource MaterialDesignOutlinedTextBoxWithBorder}"
                                 materialDesign:HintAssist.Hint="Đơn giá nhập (VNĐ)"
                                 Text="{Binding CurrentDetail.UnitImportPrice, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,10,0"/>

                        <!-- Thành tiền -->
                        <TextBox Grid.Column="3"
                                 Style="{StaticResource MaterialDesignOutlinedTextBoxWithBorder}"
                                 materialDesign:HintAssist.Hint="Thành tiền (VNĐ)"
                                 Text="{Binding CurrentDetail.Subtotal, Mode=OneWay, StringFormat='{}{0:N0}'}"
                                 IsReadOnly="True"
                                 Margin="0,0,10,0"/>

                        <!-- Nút thêm chi tiết -->
                        <Button Grid.Column="4"
                                Content="Thêm"
                                Command="{Binding AddDetailCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Background="#10B981"
                                Foreground="White"
                                Width="100"/>
                    </Grid>

                    <!-- DataGrid chi tiết -->
                    <DataGrid Grid.Row="1" 
                              ItemsSource="{Binding ImportDetails}" 
                              SelectedItem="{Binding SelectedDetail}"
                              AutoGenerateColumns="False" 
                              IsReadOnly="True" 
                              SelectionMode="Single"
                              Style="{StaticResource MaterialDesignDataGrid}"
                              CanUserAddRows="False"
                              VerticalScrollBarVisibility="Auto"
                              materialDesign:DataGridAssist.CellPadding="8">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="STT" Width="150">
                                <DataGridTextColumn.Binding>
                                    <MultiBinding StringFormat="{}{0}">
                                        <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type DataGridRow}}" Path="Header"/>
                                    </MultiBinding>
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="Sách" Binding="{Binding Book.Title}" Width="270"/>
                            <DataGridTextColumn Header="Mã ISBN" Binding="{Binding Book.ISBNCode}" Width="200"/>
                            <DataGridTextColumn Header="Số lượng" Binding="{Binding Quantity}" Width="150"/>

                            <DataGridTextColumn Header="Đơn giá" Width="170">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="UnitImportPrice" StringFormat="{}{0:N0} VNĐ" />
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="Thành tiền" Width="170">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="Subtotal" StringFormat="{}{0:N0} VNĐ" />
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>

                            <DataGridTemplateColumn Header="Thao tác" Width="auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Xóa" 
                                                Width="70" 
                                                Height="30" 
                                                Background="#EF4444" 
                                                Foreground="White" 
                                                Style="{StaticResource MaterialDesignRaisedButton}" 
                                                Command="{Binding DataContext.RemoveDetailCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Tổng tiền -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                        <TextBlock Text="Tổng tiền:" 
                                   FontSize="16" 
                                   FontWeight="Bold" 
                                   VerticalAlignment="Center"
                                   Margin="0,0,15,0"/>
                        <Border Background="#F1F5F9" 
                                Padding="15,10" 
                                CornerRadius="5" 
                                MinWidth="200">
                            <TextBlock Text="{Binding TotalAmount, StringFormat='{}{0:N0} VNĐ'}" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       HorizontalAlignment="Right"/>
                        </Border>
                    </StackPanel>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- Footer with buttons -->
        <Grid Grid.Row="3" Background="#F1F5F9">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Hủy bỏ"
                        Command="{Binding CancelCommand}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#EF4444"
                        Foreground="White"
                        Width="120"
                        Height="40"
                        Margin="0,0,15,0"/>

                <Button Content="Lưu phiếu nhập"
                        Command="{Binding SaveCommand}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#10B981"
                        Foreground="White"
                        Width="150"
                        Height="40"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
